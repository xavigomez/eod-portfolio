---
import Branding from "~/components/navigation/Branding.astro";
import NavLinks from "~/components/navigation/NavLinks.astro";
import SocialLinks from "~/components/navigation/SocialLinks.astro";
import DownloadCV from "~/components/navigation/DownloadCV.astro";
import { MobileMenuSheet } from "~/components/navigation/MobileMenuSheet";
---

<nav class="flex justify-between items-center" aria-label="Mobile navigation">
    <div id="mobile-branding">
        <Branding variant="mobile" />
    </div>
    <div class="flex items-center gap-4">
        <DownloadCV class="hidden sm:flex bg-muted-foreground" />
        <MobileMenuSheet client:load>
            <!-- FIXME: the close button is over a link and its hard to hit -->
            <nav aria-label="Mobile menu navigation">
                <NavLinks />
                <div class="border-t p-4 mt-4">
                    <SocialLinks />
                </div>
                <div class="px-4">
                    <DownloadCV
                        class="w-full cursor-pointer bg-muted-foreground flex sm:hidden"
                    />
                </div>
            </nav>
        </MobileMenuSheet>
    </div>
</nav>

<script>
    const header = document.querySelector("header");
    const introName = document.querySelector("#intro-name");
    const brandingText = document.querySelector(
        "#mobile-branding #branding-text",
    );

    if (header) {
        // If not on home page (no intro-name), show branding text immediately
        if (!introName && brandingText) {
            brandingText.classList.add("opacity-100");
        } else if (brandingText) {
            brandingText.classList.add("opacity-0");
        }

        window.addEventListener("scroll", () => {
            if (window.scrollY > 0) {
                header.classList.add("border-b", "border-border");
            } else {
                header.classList.remove("border-b", "border-border");
            }

            // Only do the branding text scroll effect on home page
            if (introName && brandingText) {
                const introBottom = introName.getBoundingClientRect().bottom;

                if (introBottom <= header.offsetHeight) {
                    brandingText.classList.remove("opacity-0");
                    brandingText.classList.add("opacity-100");
                } else {
                    brandingText.classList.remove("opacity-100");
                    brandingText.classList.add("opacity-0");
                }
            }
        });
    }
</script>
