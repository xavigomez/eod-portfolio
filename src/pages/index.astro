---
import Layout from "~/layouts/Layout.astro";
import Badges from "~/components/sections/Badges.astro";
import Gallery from "~/components/sections/Gallery.astro";
import Introduction from "~/components/sections/Introduction.astro";
import WorkShowcase from "~/components/sections/WorkShowcase.astro";
import { gallery, work } from "~/data/home";
import { Button } from "~/components/ui/button";
import { Badge } from "~/components/ui/badge";
---

<Layout>
    <div class="px-4 py-2 sm:px-8 sm:py-4 lg:p-0">
        <Introduction />
        <Badges class="mt-6" />
        <Gallery class="mt-24" rows={gallery} />
        <section id="work" class="space-y-12 mt-24">
            <div
                class="flex items-end [&>hr]:border-t-2 [&>hr]:border-foreground [&>hr]:mb-2"
            >
                <hr class="w-14 mr-2" />
                <hr class="flex-1" />
                <h2 class="text-5xl sm:text-7xl font-bold">Work</h2>
            </div>

            <!-- Using the new WorkShowcase component -->
            <div class="space-y-8">
                {work.map((item) => <WorkShowcase {...item} />)}
            </div>
        </section>
    </div>
</Layout>

<!-- FIXME: extract to a common place, it is shared with Gallery.astro -->
<style>
    .gallery-item {
        position: relative;
        overflow: hidden;
        perspective: 1000px;
    }

    .gallery-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease-out;
    }

    .gallery-item::after {
        content: "";
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.15);
        transition: opacity 0.3s ease-out;
        pointer-events: none;
        border-radius: inherit;
    }

    .gallery-item:hover::after {
        opacity: 0;
    }
</style>

<!-- FIXME: extract to a common place, it is shared with Gallery.astro -->
<script>
    document.querySelectorAll(".gallery-item").forEach((item) => {
        const el = item as HTMLElement;
        const img = el.querySelector("img");
        if (!img) return;

        el.addEventListener("mousemove", (e) => {
            const rect = el.getBoundingClientRect();
            const centerX = rect.width / 2;
            const centerY = rect.height / 2;
            const x = e.clientX - rect.left - centerX;
            const y = e.clientY - rect.top - centerY;

            const rotateX = (y / centerY) * -8;
            const rotateY = (x / centerX) * 8;

            img.style.transform = `scale(1.1) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
        });

        el.addEventListener("mouseleave", () => {
            img.style.transform = "";
        });
    });
</script>
