---
import "~/styles/global.css";
import { ClientRouter } from "astro:transitions";
import DesktopNav from "~/components/navigation/DesktopNav.astro";
import MobileNav from "~/components/navigation/MobileNav.astro";
import Footer from "~/components/Footer.astro";
---

<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="generator" content={Astro.generator} />
        <!-- <ClientRouter /> -->
        <slot name="head" />
    </head>
    <body class="min-h-screen lg:mb-8 xl:mb-16 2xl:mb-24">
        <div
            class="mx-auto max-w-432 lg:flex lg:flex-row lg:p-8 xl:p-16 2xl:p-24 lg:gap-16 xl:gap-24 2xl:gap-36"
        >
            <!-- Mobile header bar -->
            <header
                class="lg:hidden py-2 sm:py-4 px-3 sm:px-6 top-0 sticky bg-background/80 backdrop-blur-sm z-10"
            >
                <MobileNav />
            </header>
            <div class="hidden lg:block">
                <!-- Desktop sidebar -->
                <aside
                    class="hidden lg:flex lg:w-60 lg:shrink-0 flex-col sticky top-8"
                >
                    <DesktopNav />
                </aside>
            </div>
            <main id="top" class="flex-1">
                <slot />
            </main>
        </div>
        <div class="mx-auto max-w-432">
            <Footer />
        </div>

        <script>
            document.addEventListener("mousemove", (e) => {
                const target = e.target as HTMLElement;

                // Gallery item tilt (with scale)
                const galleryEl = target.closest(
                    ".gallery-item",
                ) as HTMLElement;
                if (galleryEl) {
                    const img = (galleryEl.querySelector("img.opacity-100") ||
                        galleryEl.querySelector(
                            "img:not(.opacity-0)",
                        )) as HTMLImageElement;
                    if (img) {
                        const rect = galleryEl.getBoundingClientRect();
                        const centerX = rect.width / 2;
                        const centerY = rect.height / 2;
                        const x = e.clientX - rect.left - centerX;
                        const y = e.clientY - rect.top - centerY;

                        const rotateX = (y / centerY) * -4;
                        const rotateY = (x / centerX) * 4;

                        img.style.transform = `scale(1.1) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
                    }
                }

                // Tilt card effect (no scale)
                const tiltCard = target.closest(".tilt-card") as HTMLElement;
                if (tiltCard) {
                    const rect = tiltCard.getBoundingClientRect();
                    const centerX = rect.width / 2;
                    const centerY = rect.height / 2;
                    const x = e.clientX - rect.left - centerX;
                    const y = e.clientY - rect.top - centerY;

                    const rotateX = (y / centerY) * -2;
                    const rotateY = (x / centerX) * 2;

                    tiltCard.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
                }
            });

            document.addEventListener("mouseout", (e) => {
                const target = e.target as HTMLElement;

                // Gallery item reset
                const galleryEl = target.closest(
                    ".gallery-item",
                ) as HTMLElement;
                if (galleryEl) {
                    const relatedTarget = (e as MouseEvent)
                        .relatedTarget as HTMLElement;
                    if (!relatedTarget || !galleryEl.contains(relatedTarget)) {
                        galleryEl.querySelectorAll("img").forEach((img) => {
                            img.style.transform = "";
                        });
                    }
                }

                // Tilt card reset
                const tiltCard = target.closest(".tilt-card") as HTMLElement;
                if (tiltCard) {
                    const relatedTarget = (e as MouseEvent)
                        .relatedTarget as HTMLElement;
                    if (!relatedTarget || !tiltCard.contains(relatedTarget)) {
                        tiltCard.style.transform = "";
                    }
                }
            });
        </script>
    </body>
</html>
